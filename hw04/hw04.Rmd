---
title: 'Homework #4'
author: "Kaitlyn Harper"
date: "October 5, 2017"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(tidyverse)
library(knitr)

```

## Part 1, Activity #1 - Cheatsheet for dealing with messy data

Hi there! Welcome to my messy data cheatsheet. I got most of my information from [this](http://vita.had.co.nz/papers/tidy-data.pdf) paper, written by the one and only Hadley Wickham. He goes into a lot more detail and uses large data sets as examples, so definitely check it out if you find yourself itching for more information! 

Okay then, let's get going!

### What's the deal with "messy data"?
Imagine this: You get to your office early one morning, keen to start your productive work day. The sun is shining, the birds are singing, and you're READY to explore that new data set your supervisor shared with you yesterday. Or so you think. As you sip your coffee, you open up the new data set in R and...

You see this:
```{r messyData1, echo=FALSE}

farts = data.frame(subject = c(rep(LETTERS[1:5], each=3)),
                        sex = c("m", "m", "m", "f", "f", "f","m", "m", "m", "f", "f", "f", "m", "m", "m"),
                        food = c("bb", "ch", "cab"),
                        number = c(12,8,9,13,4,7,10,25,6,11,10,11,16,14,4),
                        smelliness = c(3,4,3,4,1,3,4,5,2,3,3,3,4,4,2))

farts_messy = spread(farts, smelliness, number) %>% 
  select(-sex)

farts_messy$subject = paste(farts$subject, farts$sex, sep="")

knitr::kable(farts_messy)

```

This, my friends, is what we call messy data. Like, what is even going on here?? Oh wait- what's that? Ohhhh, luckily, there's a note on your desk with more information about the data! Unnnnluckily, it's in the handwriting of the first year undergrad that also works in your lab...

*"Hi! I collected these data for you because I'm helpful and I want you to like me! The study is on what types of foods make people fart the most and with the most smelliness! There are five subjects (letters A:E), each with a binary sex (m/f) attached to it (Am = subject A, male). The food column is just three different foods that the subject ate (bb=baked beans, ch=cheese, cb=cabbage). Each of the other columns ("1"-"5") represent the smelliness level of farts (1=roses, 5=rotten meat), and the values represent the number of times they farted from the specific food over a three day period. As you can see, it's a really well-planned, carefully-collected, and powerful study--I designed it myself, of course-- and I thought it would be fun if you could analyze all the data for me! Thanks!"*

Wow, yep, super fun. Thanks. 

See, in a perfect world we would have beautiful data all the time, and analysing it would be a breeze. Unfortunately, we live in a world where Donald Trump became president of the United States (i.e. not perfect); thus, the data we're given isn't always clean and pristine. 

There are **three things** that make data tidy, according to our good friend Hadley. Let's see if your data fit the criteria:  
  - Each variable forms a column. *Nope, nowhere in there do I see the "number of farts" variable*  
  - Each observation forms a row. *Okay, we're good with this one I think*  
  - Each type of observational unit forms a table. *Nope, we need to separate subject and sex* 
  
Looks like we definitely have some cleaning to do. Alright, enough yabbering, get going on those analyses!

<a href="#top">Back to top</a>

### `Gather`  
But what to do about these messy data? Doo-doo-DOO! :trumpet: Have no fear - `gather` is here! `Gather` is a really helpful function in the `tidyr` package that literally "gathers" up your data and collapses it into what are known as "key-value pairs". The `key` part takes each of the header (column) names that you specify and makes them into variables. The `value` part takes each of the messy values that are all spread out in the original "key" columns and **stacks them** on top of each other. Let's see it in action: 

```{r gather1, echo=TRUE}

(test = gather(farts_messy, smelliness, number, -c(subject, food)))

# smelliness = key: the name of the NEW column that will include each OLD column headers that became a variable
# number = value: the name of the NEW stacked-variable column
# 3:7 = "..." : the columns to include in the gathering (reshaping)

```

Notice that the 1-5 columns are gone. Those values are now stacked on top of each other in a new "smelliness" column. Additionally, all those values from the original 1-5 columns were put in a single variable called "number" (remember it's the number of farts caused by a certain food). They're The bummer part about our data is that we have a bunch of NAs hanging around from our original data set, so our \*new and improved\* data frame still looks at bit messy. But hey, we can deal with that. Let's see what our dplyr functions can do for us: 

```{r}

clean_farts = test %>% 
  na.omit() %>%                  # get rid of NAs
  arrange(subject, food) %>%     # arrange data set by subject 
  mutate(subject = substr(farts_messy$subject, start = 1, stop = 1),
         sex = substr(farts_messy$subject, start = 2, stop = 2)) %>% 
  
  # substr: breaks apart a string of characters
      # farts_messy$subject: variable to break apart
      # start = __: where to start the break
      # stop = __: where to end the break
  
  select(subject, sex, everything()) #rearrange the columns with sex toward the front (my personal preference)

knitr::kable(clean_farts)
```

Oh dplyr, how I love thee :heart: But seriously, are you seeing this?! We now have a perfectly useful data set. Let's just quickly plot it and see if we can pick out any patterns! 

<a href="#top">Back to top</a>

### Flatterns (flatulence patterns)
```{r plotFarts, echo=TRUE}

label_names = c("bb"="Baked beans", "cab"="Cabbage", "ch" = "Cheese", "f"="Female", "m"="Male")

clean_farts %>% 
  ggplot(aes(x=subject, y=number)) +
  geom_bar(stat="identity", aes(fill=smelliness)) +
  facet_grid(sex~food, labeller = as_labeller(label_names)) +
  ggtitle("The frequency and ferocity of flatulence after various foods")
  

```

Without doing any statistics (and given we have the world's smallest sample size), it's pretty hard to tell if any patterns emerge (although subject C may want to check if they're lactose-intolerant). Let's say we leave those biostats for a different day... or never...

<a href="#top">Back to top</a>

### Spread
While I have you here though, let's talk about the other helpful `tidyr` function: `spread`! Okay, so you cleaned your data set, but realized that you actually want to look more closely at the frequency of fart, grouped by smelliness. (Note: this probably isn't the BEST example, since it's actually making the data messier, but it gets the point across).

```{r spread, echo=TRUE}

farts %>% 
  spread(food, number, 0)

# food = key: the variable that you want broken down ("spread" out) into different columns 
# number = value: the values that will fill into your new columns
# 0 = fill: the default for this is NULL (nothing), but if you add it in, it'll fill in instead of NAs

```

So there you go! Both `gather` and `spread` are useful ways to tidy your data without getting a headache. Hooray for simple functions! 

<a href="#top">Back to top</a>

## Part 2, Activity __ 
