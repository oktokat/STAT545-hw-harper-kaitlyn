---
title: "Homework 5"
author: "Kaitlyn Harper"
date: "October 18, 2017"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction: zvitambo data set

Hi y'all!! Thanks for checking out my hw assignment #5. For this assignment, I decided to branch out a bit and use a new data set. These data come from a big longitudinal study in Zimbabwe that was studying growth of children. In this first chunk, I'm going to use the`source` function to load the data set. Basically the `source` function finds another file (in this case, another R script) and runs it. I used this because I had to do a little removing of sensitive information before using this data set for class, so I did all of that in another R script. Okie doke, let's take a look at what we've got! 

```{r load, echo=TRUE}

suppressMessages(library(knitr))
library(forcats)

### Load data and packages
suppressMessages(source("/Users/kaitlynharper/Google Drive/UBC/Fall 2017/SPPH 501/SPPH501/Code/zvitambo_load.R"))

### Remove sensitive information and most variables
source("/Users/kaitlynharper/Google Drive/UBC/Fall 2017/STAT 545/STAT545-hw-harper-kaitlyn/hw05/clean_zvitambo_data.R")

glimpse(stunted)

```

These variables might not make much sense, so here's a little metadata df to help you out:
```{r metadata, echo=TRUE}

metadata = data.frame(variable = names(stunted),
                      interpretation = c("Subject ID", "Age", "Sex", "Height-for-age z-score",
                                         "Type of birth", "Mother's age at time of birth",
                                         "No breastfeeding (0=false, 1=true)", "Low birthweight (0=no)",
                                         "Born at term (0=no)", "Number of siblings", "Stunted growth (0=no)",
                                         "Number of visits to the hospital between measurements"))

kable(metadata)

```

Just to clarify:  
  - There are ~3000 unique subject id's in this data set. Each individual was observed somewhere between 4-10 times over 0-24 months  
  - the main outcome here is the **height-for-age z-score** (`zlen`), a measure of how tall the baby is from 0-24 months. All you need to know is higher zlen = better, lower = worse. Basically all of the other variables are covariates that could influence growth.


<a href="#top">Back to top</a>

## Factor management

### Change integer variables to factors  
There are a bunch of variables in this data set that need to be changed to factor. Let's see how it goes:

```{r changeInt, echo=TRUE}

### Make categorical vectors into factors

# columns of integers that need to be changed  
cols = c("sex", "noBF", "lbw", "term", "stunt", "c.visits.i")

# change integers to factors    
stunted = stunted %>% 
  mutate_at(cols, funs(factor(.)))

glimpse(stunted)

rm(cols)

```

*A little explanation:*  
`mutate_at` is a helpful function that allows you to mutate multiple columns at the same time. Basically what I did was create a vector of column names (`cols`) for the variables that I want to change from integer to factor. Then I said, "hey stunted, mutate all of these columns by changing them all to factors!" <-- I did this using the `funs(factor(.))` argument. The `.` basically says, "do this function to all the columns you specified in the previous argument". I got the code for this from [stack overflow](https://stackoverflow.com/questions/33180058/coerce-multiple-columns-to-factors-at-once).  

Oh, also, that little `rm(cols)` function just gets rid of the new object (`cols`) that I created. I use this a ton just to keep my environment uncluttered, since in these hw assignments I tend to make a lot of new variables and it's hard to keep track of them all if they're all sitting there in the enviro.

I couldn't figure out how to use`forcats` to change multiple columns at once, but don't fret, I experiment with a few other `forcats` functions in the upcoming sections...

<a href="#top">Back to top</a>

### Condense hospital visits
The number of times an individual went to the hospital between growth measurement was recorded in the `c.visits.i` variable. There was a pretty wide variety, as seen here:

```{r visitsTable, echo=TRUE}

table(stunted$c.visits.i)

```

As you can see, there were a lot of individuals who had between 0-2 visits, and then it tapers off toward the higher number of visits. Let's use `fct_lump` to condense the number of visits into just four categories: 0, 1, 2, and 3+.

```{r fct_lump, echo=TRUE}

stunted = stunted %>% 
  mutate(visits = fct_lump(c.visits.i, n = 3, other_level = "3+")) %>%
  select(-c.visits.i) # remove c.visits.i so we only have visits variable left

table(stunted$visits)

```

**A little explanation:**  
  - `n=3` conserves only the top three categories and lumps everything else into the "other" category  
  - `other_level = "3+"` renames the other level to "3+" so that it doesn't just say "other"
  
### Count the entries in a factor 
To count how many entries you have in each level of a factor, you can use `fct_count`. In this example, I'm counting how many entries are in each level of "mother's age" (i.e. how old the mother was when the baby was born). First I'll change that variable into a factor, and then I'll create a new table showing only the levels and the number of entries.


```{r}

mothersAge = stunted %>% 
  mutate(m.age.fact = factor(m.age))

mothersAge = fct_count(mothersAge$m.age.fact, sort=TRUE) #

kable(head(mothersAge, 10)) #only showing the first 10 levels 

rm(mothersAge)

```


### Reorder the levels of `idno` based on `zlen` variable
```{r}

low_zlen_factor = fct_reorder(stunted$idno, stunted$zlen, min) %>% 
  levels() %>% 
  head()

lowest = stunted %>% 
  filter(idno %in% low_zlen_factor) %>% 
  group_by(idno) %>% 
  filter(zlen == min(zlen)) %>% 
  select(idno, zlen)

kable(lowest)

rm(lowest, low_zlen_factor)

```

### Explore `arrange`

**Does merely arranging the data have any effect on a figure?**

**What effect does reordering a factor, coupled with arrange, have on a figure?**




## Write `stunted` df to file

### 

### 













<a href="#top">Back to top</a>