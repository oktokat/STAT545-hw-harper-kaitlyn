---
title: 'Homework #3'
author: "Kaitlyn Harper"
date: "September 28, 2017"
output: 
  github_document:
    toc: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load data and packages
```{r load_data, message=FALSE}

# Load packages
library(tidyverse)
library(knitr)

# Load gapminder dataset
library(gapminder)
data("gapminder")

#View data (just to make sure it's there)
head(gapminder)

```

<a href="#top">Back to top</a>

### Look at the spread of GDP per capita within the continents.

```{r max_min, results='asis'}

min_max = gapminder %>% 
  group_by(continent) %>% 
  summarise(maxGDP = max(gdpPercap), 
            minGDP = min(gdpPercap),
            meanGDP = mean(gdpPercap),
            sdGDP = sd(gdpPercap))

knitr::kable(min_max, col.names = c("Continent", "Max GDP", "Min GDP", "Mean GDP", "SD GDP"), format = "html", caption = "Table 1. Spread of GDP per capita within each continent")

```

```{r spreadPlot, echo=TRUE}

gapminder %>%
  ggplot(aes(x=continent, y=gdpPercap)) +
  geom_boxplot(aes(fill = continent), show.legend = FALSE) +
  labs(x = "Country", y = "GDP per capita", title = "Spread of GDP per capita within each continent") +
  theme_dark(base_size = 13, base_family = "Courier")

rm(min_max)

```

<a href="#top">Back to top</a>

## How is life expectancy changing over time on different continents?  

```{r LEtable, echo=TRUE}

gapMeanLE = gapminder %>%
  group_by(continent, year) %>% 
  summarise(meanLE = mean(lifeExp))

gapMeanLE = gapMeanLE %>%
  group_by(continent) %>% 
  summarise(deltaLE = round(meanLE[year==2007] - meanLE[year==1952], 2))

knitr::kable(gapMeanLE, col.names = c("Continent", "Years"), align = "c", format = "html", caption = "Table 2. Increases in life expectancy (in years) from 1952-2007")

```


```{r LEplot, echo=TRUE}

gapminder %>%
  group_by(continent, year) %>% 
  summarise(meanLE = mean(lifeExp)) %>% 
  ggplot(aes(x=year, y=meanLE)) +
  geom_smooth(aes(color=continent), se=FALSE) +
  scale_color_discrete("Continents") +
  labs(x="Year", y= "Mean Life Expectancy (Years)", title="Life expectancy changes in each continent, 1952-2007") +
  theme_light(base_family = "Palatino") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.border = element_blank())

rm(gapMeanLE)

```

## Report the absolute and/or relative abundance of countries with low life expectancy over time by continent: Compute some measure of worldwide life expectancy – you decide – a mean or median or some other quantile or perhaps your current age. Then determine how many countries on each continent have a life expectancy less than this benchmark, for each year.

```{r lowLE, echo=TRUE}

# Find the global mean and median life expectancies
summary(gapminder$lifeExp)[3:4] # median= ~59, mean= ~60

# Make table for countries with low LE
gapLowLE <- gapminder %>% 
    mutate(LEcat=c("low", "high")[(lifeExp>summary(gapminder$lifeExp)[[4]]) + 1]) %>% 
    filter(LEcat=="low") %>% 
    group_by(continent, year) %>% 
    summarise(numberLow = n())

# number of unique countries
gapminder %>% 
  group_by(continent) %>% 
  summarise(n()/12)


# knitr::kable(tab1, col.names = c("Life Expectancy", "N (%)"), align = "l", format = "html", caption = "Table 2. Increases in life expectancy (in years) from 1952-2007")

```
The chunk of code above is a bit messy, so I'm going to explain what I did here.  

*Part 1*
- `gapLowLE <- gapminder %>%`: create a new data frame called gapLowLE with the same data as gapminder  
- `mutate(LEcat=c("low", "high")[(lifeExp>summary(gapminder$lifeExp)[[4]]) + 1])`: create a new column in gapLowLE that categorizes life expectancy. Countries with a life expectancy under the mean (`summary(gapminder$lifeExp)[[4]]`) were categorized as low, while those above were categorized as high.

*Part 2*
- `tab1 = data.frame(table(gapLowLE$LEcat)) %>%` create a new data frame of the frequencies 

## Find countries with interesting stories. Open-ended and, therefore, hard. Promising but unsuccessful attempts are encouraged. This will generate interesting questions to follow up on in class.
